
## Setting Up a Basic HTTP Server

Express.js is a minimal and flexible Node.js web application framework that provides a robust set of features for web and mobile applications.

```javascript
// Import Express
const express = require('express');

// Create an Express application
const app = express();

// Define the port
const port = 3000;

// Start the server
app.listen(port, () => {
  console.log(`Server running at http://localhost:${port}`);
});
```

## Routing

Express provides a way to define routes to handle HTTP requests based on method and path.

```javascript
// Basic route structure: app.METHOD(PATH, HANDLER)

// GET request to root URL
app.get('/', (req, res) => {
  res.send('Hello World!');
});

// POST request example
app.post('/users', (req, res) => {
  // Create a new user
  res.send('User created');
});

// Route parameters
app.get('/users/:userId', (req, res) => {
  res.send(`User ID: ${req.params.userId}`);
});

// Multiple route handlers
app.get('/complex', 
  (req, res, next) => {
    // First middleware
    console.log('First handler');
    next();
  },
  (req, res) => {
    // Second middleware
    res.send('Complex route handled');
  }
);

// Route modules organization
const userRoutes = express.Router();
app.use('/users', userRoutes);

userRoutes.get('/', (req, res) => res.send('User list'));
userRoutes.post('/', (req, res) => res.send('Create user'));
```

## Middleware

Middleware functions have access to the request and response objects, and the next middleware function in the application's request-response cycle.

```javascript
// Application-level middleware
app.use((req, res, next) => {
  console.log(`${req.method} ${req.url} - ${new Date()}`);
  next(); // Passes control to the next middleware
});

// Route-specific middleware
const authenticate = (req, res, next) => {
  if (req.headers.authorization) {
    next();
  } else {
    res.status(401).send('Authentication required');
  }
};

app.get('/protected', authenticate, (req, res) => {
  res.send('Protected content');
});

// Built-in middleware
app.use(express.json()); // Parse JSON bodies
app.use(express.urlencoded({ extended: true })); // Parse URL-encoded bodies
```

## Error Handling

Express provides mechanisms to handle errors that occur during the request-response cycle.

```javascript
// Synchronous error handling
app.get('/error', (req, res) => {
  throw new Error('Something went wrong');
});

// Error-handling middleware (must have 4 parameters)
app.use((err, req, res, next) => {
  console.error(err.stack);
  res.status(500).send('Something broke!');
});

// Asynchronous error handling
app.get('/async-error', async (req, res, next) => {
  try {
    // Async operation that might fail
    const result = await someAsyncFunction();
    res.send(result);
  } catch (error) {
    next(error); // Pass errors to Express
  }
});

// Custom error handling for specific routes
app.get('/users/:id', async (req, res, next) => {
  try {
    const user = await findUser(req.params.id);
    if (!user) {
      // Create and throw a custom error
      const error = new Error('User not found');
      error.statusCode = 404;
      throw error;
    }
    res.send(user);
  } catch (error) {
    next(error);
  }
});

// Custom error handler middleware with status codes
app.use((err, req, res, next) => {
  res.status(err.statusCode || 500).json({
    error: {
      message: err.message || 'Internal Server Error',
      status: err.statusCode || 500
    }
  });
});
```

## Serving Static Files

Express can serve static files like images, CSS, and JavaScript.

```javascript
// Serve static files from a directory
app.use(express.static('public'));

// Specify a mount path
app.use('/assets', express.static('public'));

// Multiple static directories
app.use(express.static('public'));
app.use(express.static('files'));

// Configure static file serving options
app.use(express.static('public', {
  dotfiles: 'ignore',
  etag: false,
  extensions: ['html', 'htm'],
  index: false,
  maxAge: '1d',
  redirect: false,
  setHeaders: (res, path, stat) => {
    res.set('x-timestamp', Date.now());
  }
}));
```

## Environment-Specific Configuration

```javascript
// Configure app based on environment
if (process.env.NODE_ENV === 'development') {
  app.use(require('morgan')('dev')); // Logging middleware for development
} else {
  app.use(require('compression')()); // Compress responses in production
}
```

Would you like me to explain any part of these fundamentals in more detail?