
## **Authentication** (Proving Identity)

### What is Authentication?
- Process of verifying a user's identity (who they claim to be)
- Common methods: Username/password, social logins, biometrics

### Key Components in Express:
1. **User Registration**
   - Create user accounts with credentials (usually email + password)
   - Store in MongoDB database
2. **User Login**
   - Verify credentials against stored data
3. **Session Management**
   - Maintain logged-in state (using sessions or tokens)

---

### Implementation Steps (Authentication)

1. **User Model Setup**
```javascript
// models/User.js
const mongoose = require('mongoose');
const bcrypt = require('bcryptjs');

const userSchema = new mongoose.Schema({
  email: { type: String, required: true, unique: true },
  password: { type: String, required: true },
  // ... other fields
});

// Hash password before saving
userSchema.pre('save', async function(next) {
  if (this.isModified('password')) {
    this.password = await bcrypt.hash(this.password, 10);
  }
  next();
});

module.exports = mongoose.model('User', userSchema);
```

2. **Registration Route**
```javascript
// routes/auth.js
const express = require('express');
const router = express.Router();
const User = require('../models/User');

router.post('/register', async (req, res) => {
  try {
    const { email, password } = req.body;
    const user = new User({ email, password });
    await user.save();
    res.status(201).send('User created');
  } catch (error) {
    res.status(400).send(error.message);
  }
});
```

3. **Login Route (Using JWT)**
```javascript
const jwt = require('jsonwebtoken');

router.post('/login', async (req, res) => {
  try {
    const { email, password } = req.body;
    const user = await User.findOne({ email });
    
    if (!user || !(await bcrypt.compare(password, user.password))) {
      return res.status(401).send('Invalid credentials');
    }

    // Create token
    const token = jwt.sign(
      { userId: user._id },
      process.env.JWT_SECRET,
      { expiresIn: '1h' }
    );
    
    res.json({ token });
  } catch (error) {
    res.status(500).send(error.message);
  }
});
```

### Authentication Packages
- `bcryptjs`: Password hashing
- `jsonwebtoken`: JWT creation/verification
- `passport.js`: Authentication middleware (optional for beginners)

---

## **Authorization** (Permission Management)

### What is Authorization?
- Determining what an authenticated user is allowed to do
- Examples:
  - Admin-only routes
  - User-specific resource access
  - Role-based permissions

### Key Concepts:
1. **Middleware Functions**
   - Check permissions before route execution
2. **Role-Based Access Control (RBAC)**
   - Users have roles with specific permissions
3. **Resource Ownership**
   - Verify user owns the requested resource

---

### Implementation Steps (Authorization)

1. **Authentication Middleware**
```javascript
// middleware/auth.js
const jwt = require('jsonwebtoken');

const authMiddleware = (req, res, next) => {
  const token = req.header('Authorization')?.replace('Bearer ', '');
  
  if (!token) {
    return res.status(401).send('Access denied');
  }

  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    req.user = decoded; // Attach user to request
    next();
  } catch (error) {
    res.status(401).send('Invalid token');
  }
};

module.exports = authMiddleware;
```

2. **Route Protection**
```javascript
// routes/protected.js
const express = require('express');
const router = express.Router();
const authMiddleware = require('../middleware/auth');

router.get('/dashboard', authMiddleware, (req, res) => {
  res.send(`Welcome to your dashboard, user ${req.user.userId}`);
});
```

3. **Role-Based Authorization**
```javascript
// Add role to User schema
const userSchema = new mongoose.Schema({
  // ...
  role: { type: String, enum: ['user', 'admin'], default: 'user' }
});

// Admin middleware
const adminMiddleware = (req, res, next) => {
  if (req.user.role !== 'admin') {
    return res.status(403).send('Admin access required');
  }
  next();
};

// Protected admin route
router.get('/admin', authMiddleware, adminMiddleware, (req, res) => {
  res.send('Admin dashboard');
});
```

### Authorization Patterns
- **Middleware Chaining**: Combine multiple checks
- **Ownership Checks**: 
  ```javascript
  router.delete('/posts/:id', authMiddleware, async (req, res) => {
    const post = await Post.findById(req.params.id);
    if (post.author.toString() !== req.user.userId) {
      return res.status(403).send('Not authorized');
    }
    await post.remove();
    res.send('Post deleted');
  });
  ```

---

## Key Differences
| **Authentication**          | **Authorization**               |
|------------------------------|----------------------------------|
| Verifies identity            | Grants permissions              |
| Done first                   | Done after authentication       |
| Uses credentials             | Uses roles/permissions          |
| Example: Login               | Example: Admin dashboard access |

---

## Best Practices
1. **Authentication**
   - Always hash passwords (never store plain text)
   - Use HTTPS in production
   - Set token expiration times
   - Secure cookies if using session-based auth

2. **Authorization**
   - Follow principle of least privilege
   - Validate ownership for resource access
   - Use centralized error handling
   - Audit permissions regularly

---

## Common Packages
| Purpose          | Packages                      |
|------------------|-------------------------------|
| Password Hashing | bcryptjs                      |
| Tokens           | jsonwebtoken                  |
| Sessions         | express-session, cookie-parser|
| Middleware       | passport.js (advanced)        |